# Yomitoku OCR Streamlit Web UI

StreamlitベースのYomitoku OCR WebインターフェースUIです。

## インストール

```bash
# Streamlit依存関係のインストール
pip install -e ".[streamlit]"
```

## 起動方法

```bash
streamlit run app.py
```

ブラウザで自動的に開かない場合は、ターミナルに表示されるURLにアクセスしてください（通常は `http://localhost:8501`）。

## 使い方

### 1. 画像の入力

以下の2つの方法で画像を入力できます：

- **ファイルアップロード**: ドラッグ&ドロップまたはファイル選択
- **クリップボード貼り付け**: スクリーンショットなどを直接貼り付け

対応形式: PNG, JPG, JPEG, PDF, TIFF, BMP

### 2. 画像プレビュー

選択/貼り付けした画像が表示されます。

### 3. 出力形式の選択

処理結果の出力形式を選択します：

- **Markdown** (デフォルト)
- **JSON**
- **HTML**
- **CSV**

### 4. OCR実行

「🚀 Execute Yomitoku」ボタンをクリックして処理を開始します。

- 画像未選択時はボタンが無効化されます
- 処理中はプログレスバーが表示されます
- 処理時間: 画像サイズにより数秒〜数分

### 5. 結果の確認

右カラムに処理結果が表示されます：

- **Preview**: 結果のプレビュー（Markdownは整形表示）
- **Copy to Clipboard**: テキストエリアから結果をコピー
- **Download**: 選択した形式でファイルをダウンロード

ダウンロードファイル名: `元ファイル名_yyyymmdd_ocr.拡張子`

例: `screenshot_20251105_ocr.md`

## yomitokuオプション

このUIでは以下のyomitokuオプションを使用します：

- `-f [format]`: 出力形式（UIで選択）
- `-o [output_dir]`: 出力先ディレクトリ（自動生成）
- `--figure_letter`: 図表内の文字を抽出

## ファイル管理

- 一時ファイルは `./temp/` に保存されます
- 処理完了後も一時ファイルは残ります（手動削除可能）
- タイムスタンプでファイル名の衝突を回避

## エラーハンドリング

- **画像未選択**: 実行ボタンが無効化されます
- **非対応ファイル形式**: エラーメッセージが表示されます
- **処理失敗**: 「処理に失敗しました。再度実行してください」と表示されます
- **タイムアウト**: 5分でタイムアウトします

## 制限事項

- 1枚ずつ処理（複数ファイルの一括処理は非対応）
- GPU推奨（CPU実行は処理時間が長くなります）
- ファイルサイズ制限はStreamlitのデフォルト設定に依存（200MB）

## トラブルシューティング

### yomitokuコマンドが見つからない

```bash
# yomitokuがインストールされているか確認
pip list | grep yomitoku

# インストールされていない場合
pip install -e .
```

### streamlit-paste-buttonが動作しない

ブラウザのクリップボード権限を確認してください。一部のブラウザではHTTPS接続が必要です。

### 処理が遅い

- GPU環境での実行を推奨します
- 入力画像の解像度を下げることで高速化できます（ただし精度は低下）
- 軽量モデルオプション（現在未実装）の追加を検討してください

## 開発者向け情報

### ディレクトリ構造

```
.
├── app.py              # Streamlit UIメインファイル
├── temp/              # 一時ファイル保存ディレクトリ（自動生成）
└── pyproject.toml     # 依存関係定義
```

### カスタマイズ

`app.py`の以下の定数を変更することでカスタマイズ可能です：

```python
TEMP_DIR = Path("./temp")  # 一時ファイルディレクトリ
SUPPORTED_FORMATS = ["png", "jpg", "jpeg", "pdf", "tiff", "bmp"]  # 対応形式
OUTPUT_FORMATS = {  # 出力形式
    "Markdown": "md",
    "JSON": "json",
    "HTML": "html",
    "CSV": "csv",
}
```
